# mid360.yaml Parameter Deep Dive (with code references)

References are workspace-relative links to the exact source lines that read or act on each parameter.

## common
- `lid_topic` (default `livox/points`; [`laserMapping.cpp#L1238`](src/laserMapping.cpp#L1238), [`laserMapping.cpp#L1378`](src/laserMapping.cpp#L1378)): LiDAR subscription topic. Wrong topic leaves `standard_pcl_cbk` without data, so no frames enter the pipeline.
- `imu_topic` (default `livox/imu`; [`laserMapping.cpp#L1240`](src/laserMapping.cpp#L1240), [`laserMapping.cpp#L1383`](src/laserMapping.cpp#L1383)): IMU subscription. A mismatch stops undistortion and propagation.
- `time_offset_lidar_imu` (default `0.0`; [`laserMapping.cpp#L1242`](src/laserMapping.cpp#L1242), [`laserMapping.cpp#L558`](src/laserMapping.cpp#L558)): Offset subtracted from IMU timestamps. Wrong values misalign IMU/LiDAR, producing motion distortion; can also trigger “offset time” drops in preprocess.
- `drone_id` (default `1`; [`laserMapping.cpp#L1244`](src/laserMapping.cpp#L1244), [`laserMapping.cpp#L1297`](src/laserMapping.cpp#L1297), [`MultiUAV.cpp#L35`](src/MultiUAV.cpp#L35)): Swarm identity and topic prefix (simulation adds `bot{id}/`). Duplicate IDs make `QuadstateCbk` ignore peer messages, disabling mutual observations.

## multiuav
- `cluster_extraction_in_predict_region` (default `true`; [`MultiUAV.cpp#L41`](src/MultiUAV.cpp#L41), [`MultiUAV.cpp#L702`](src/MultiUAV.cpp#L702)): Enables ROI clustering around predicted teammate/temporary tracker positions. False skips ROI extraction, delaying/weakening mutual localization.
- `inten_threshold` (default `240`; [`MultiUAV.cpp#L42`](src/MultiUAV.cpp#L42), [`MultiUAV.cpp#L825`](src/MultiUAV.cpp#L825)): Intensity cutoff for high-reflectors. Higher = fewer, cleaner candidates; lower = more noise/spurious trackers.
- `min_high_inten_cluster_size` (default `4`; [`MultiUAV.cpp#L43`](src/MultiUAV.cpp#L43), [`MultiUAV.cpp#L791`](src/MultiUAV.cpp#L791), [`MultiUAV.cpp#L882`](src/MultiUAV.cpp#L882)): Minimum points per high-intensity cluster. Too small → noisy detections; too large → miss small markers.
- `min_cluster_size` (default `7`; [`MultiUAV.cpp#L44`](src/MultiUAV.cpp#L44)): **Unused** in current code.
- `predict_region_radius` (default `0.5 m`; [`MultiUAV.cpp#L47`](src/MultiUAV.cpp#L47), [`MultiUAV.cpp#L738`](src/MultiUAV.cpp#L738)): Search radius around predicted teammate positions. Larger tolerates drift but raises false associations; smaller can miss teammates.
- `temp_predict_region_radius` (default `0.5 m`; [`MultiUAV.cpp#L48`](src/MultiUAV.cpp#L48), [`MultiUAV.cpp#L718`](src/MultiUAV.cpp#L718)): Radius for temporary tracker search/visualization. Bigger = more clutter; smaller = missed confirmations.
- `traj_matching_start_thresh` (default `100`; [`MultiUAV.cpp#L45`](src/MultiUAV.cpp#L45), [`MultiUAV.cpp#L1089`](src/MultiUAV.cpp#L1089)): Motion excitation threshold before trajectory matching. Lower starts earlier but risks bad extrinsics; higher can block matching.
- `ave_match_error_thresh` (default `0.2`; [`MultiUAV.cpp#L46`](src/MultiUAV.cpp#L46), [`MultiUAV.cpp#L1068`](src/MultiUAV.cpp#L1068)): Max mean error for SVD matching. Higher tolerates poor matches (risk wrong transforms); lower rejects more candidates.
- `pos_num_in_traj` (default `300`; [`MultiUAV.cpp#L49`](src/MultiUAV.cpp#L49), [`MultiUAV.cpp#L500`](src/MultiUAV.cpp#L500), [`MultiUAV.cpp#L1250`](src/MultiUAV.cpp#L1250), [`laserMapping.cpp#L1538`](src/laserMapping.cpp#L1538)): Length of stored trajectories for matching. Larger = more robust but heavier; smaller = faster but less context.
- `reset_tracker_thresh` (default `5.0 s`; [`MultiUAV.cpp#L50`](src/MultiUAV.cpp#L50), [`MultiUAV.cpp#L975`](src/MultiUAV.cpp#L975)): If time since last update exceeds this, trackers reset. Short → frequent resets; long → stale propagation.
- `valid_cluster_size_thresh` (default `0.5 m`; [`MultiUAV.cpp#L51`](src/MultiUAV.cpp#L51), [`MultiUAV.cpp#L815`](src/MultiUAV.cpp#L815)): Max cluster size to be considered a UAV. Too small drops real UAVs; too large accepts big objects.
- `valid_cluster_dist_thresh` (default `0.2 m`; [`MultiUAV.cpp#L52`](src/MultiUAV.cpp#L52), [`MultiUAV.cpp#L939`](src/MultiUAV.cpp#L939)): Gating distance between predicted teammate pose and cluster. Higher → more false matches; lower → more missed observations.
- `mutual_observe_noise` (default `0.001`; [`laserMapping.cpp#L1283`](src/laserMapping.cpp#L1283), [`laserMapping.cpp#L1735`](src/laserMapping.cpp#L1735), [`laserMapping.cpp#L1860`](src/laserMapping.cpp#L1860); noise use in [`MultiUAV.cpp#L584`](src/MultiUAV.cpp#L584)): Base variance for mutual observation factors. Lower weights peers more (helps degeneracy recovery, dangerous if wrong); higher down-weights them. Degeneracy detected in `laserMapping` forces a smaller value to tighten constraints.
- `frame_num_in_sliding_window` (default `3`; [`laserMapping.cpp#L1282`](src/laserMapping.cpp#L1282), [`laserMapping.cpp#L1538`](src/laserMapping.cpp#L1538)): Frames merged for cluster extraction. Larger = denser ROI but more memory/latency.
- `actual_uav_num` (default `5`; [`MultiUAV.cpp#L53`](src/MultiUAV.cpp#L53), [`MultiUAV.cpp#L1120`](src/MultiUAV.cpp#L1120)): Expected swarm size. When trackers count reaches `actual_uav_num-1`, temporary tracker creation stops. Wrong value halts discovery early or spawns trackers indefinitely.
- `degeneration_thresh` (YAML `10.0`, fallback `30.0`; [`laserMapping.cpp#L1284`](src/laserMapping.cpp#L1284), [`laserMapping.cpp#L1734`](src/laserMapping.cpp#L1734)): Minimum singular value to accept geometry. Too high ⇒ frequent degeneracy flags (mutual obs over-trusted, extrinsic updates disabled); too low ⇒ degenerate scans slip through.

## imu_propagate
- `enable` (default `true`; [`laserMapping.cpp#L1285`](src/laserMapping.cpp#L1285), [`laserMapping.cpp#L301`](src/laserMapping.cpp#L301), [`laserMapping.cpp#L588`](src/laserMapping.cpp#L588), [`laserMapping.cpp#L1405`](src/laserMapping.cpp#L1405)): Toggles IMU-only propagation and odom publish. Off → no propagated odom topic.
- `topic` (default `lidar_slam/imu_propagate`; [`laserMapping.cpp#L1286`](src/laserMapping.cpp#L1286), [`laserMapping.cpp#L1405`](src/laserMapping.cpp#L1405)): Output topic. Change if remapping propagation odom.
- `filter_acc_en` (default `false`; [`laserMapping.cpp#L1287`](src/laserMapping.cpp#L1287), [`laserMapping.cpp#L553`](src/laserMapping.cpp#L553)): Enables low-pass filtering of accelerometer data in `imu_cbk`. Adds lag but reduces vibration noise; filtered data is what SLAM uses.

## preprocess
- `lidar_type` (default `1` for Mid-360; [`laserMapping.cpp#L1260`](src/laserMapping.cpp#L1260), [`laserMapping.cpp#L1355`](src/laserMapping.cpp#L1355), [`preprocess.cpp#L164`](src/preprocess.cpp#L164)): Selects parser branch (OUSTER/VELO/L515/SIM). Wrong type corrupts ring/time and drops points; also changes swarm defaults in simulation.
- `feature_extract_en` (default `false`; [`laserMapping.cpp#L1262`](src/laserMapping.cpp#L1262), [`preprocess.cpp#L184`](src/preprocess.cpp#L184), [`preprocess.cpp#L232`](src/preprocess.cpp#L232)): Runs feature classification when true. More CPU, fewer points; false keeps dense points without edge labels.
- `scan_line` (default `4`; [`laserMapping.cpp#L1261`](src/laserMapping.cpp#L1261), [`preprocess.cpp#L71`](src/preprocess.cpp#L71)): Expected number of rings; points with `ring >= N_SCANS` are discarded. Wrong value drops rings or misorders scans.
- `blind` (default `0.2 m`; [`laserMapping.cpp#L1259`](src/laserMapping.cpp#L1259), [`preprocess.cpp#L51`](src/preprocess.cpp#L51), [`preprocess.cpp#L706`](src/preprocess.cpp#L706)): Radius filter removing points near the sensor. Larger cleans near-field artifacts but loses close structure; too small admits noisy returns that hurt plane fits.

## calibration
- `cut_frame_en` (default `false`; [`laserMapping.cpp#L1263`](src/laserMapping.cpp#L1263), [`laserMapping.cpp#L523`](src/laserMapping.cpp#L523), [`preprocess.cpp#L45`](src/preprocess.cpp#L45)): Splits scans into `cut_frame_num` subframes. Useful for high-rate emulation; too many cuts fragment scans and add buffering overhead.
- `cut_frame_num` (default `1`; [`laserMapping.cpp#L1264`](src/laserMapping.cpp#L1264), [`laserMapping.cpp#L523`](src/laserMapping.cpp#L523)): Number of subframes when cutting is enabled. Large values overload buffers and shorten each frame’s motion context.
- `accumulate_frame_en` (default `true` in YAML; declared [`laserMapping.cpp#L1265`](src/laserMapping.cpp#L1265)): **Unused** currently.
- `original_frequency` (default `30 Hz`; [`laserMapping.cpp#L1266`](src/laserMapping.cpp#L1266), [`preprocess.cpp#L63`](src/preprocess.cpp#L63)): Expected LiDAR rate for timestamp sanity checks. Too low → points dropped as offset outliers; too high → distorted timing accepted.
- `gravity_align_enable` (default `true`; [`laserMapping.cpp#L1267`](src/laserMapping.cpp#L1267), [`laserMapping.cpp#L1486`](src/laserMapping.cpp#L1486)): Waits for IMU init/gravity alignment. Disabling leaves roll/pitch bias, hurting mapping and IMU fusion.
- `gravity_align_time` (default `10 s`; [`laserMapping.cpp#L1268`](src/laserMapping.cpp#L1268), [`laserMapping.cpp#L1491`](src/laserMapping.cpp#L1491)): Duration to wait for alignment. Too short → misalignment; too long → delayed start.
- `PX4_R_I` / `PX4_p_I` (defaults zero; [`laserMapping.cpp#L1308`](src/laserMapping.cpp#L1308), [`laserMapping.cpp#L334`](src/laserMapping.cpp#L334), [`laserMapping.cpp#L203`](src/laserMapping.cpp#L203)): IMU-to-PX4 extrinsics (deg, m). Errors cause lever-arm effects and attitude bias in gravity-frame outputs and IMU propagation.
- `level_horizon` (default `[0,0,0]`; [`laserMapping.cpp#L1308`](src/laserMapping.cpp#L1308)): Manual horizon leveling rotation. Wrong values tilt the published map frame.

## mapping
- `imu_en` (default `true`; declared [`laserMapping.cpp#L1253`](src/laserMapping.cpp#L1253)): Currently unused.
- `acc_cov` / `gyr_cov` (defaults `0.1`; [`laserMapping.cpp#L1254`](src/laserMapping.cpp#L1254), [`laserMapping.cpp#L1357`](src/laserMapping.cpp#L1357)): IMU noise used in `ImuProcess`. Lower → over-trust IMU; higher → rely more on LiDAR.
- `b_acc_cov` / `b_gyr_cov` (defaults `0.0001`; [`laserMapping.cpp#L1257`](src/laserMapping.cpp#L1257), [`laserMapping.cpp#L1359`](src/laserMapping.cpp#L1359)): Bias random-walk covariances. Higher adapts faster (may absorb motion); lower adapts slowly (may retain bias).
- `det_range` (default `100.0 m`; [`laserMapping.cpp#L1252`](src/laserMapping.cpp#L1252), FOV control [`laserMapping.cpp#L471`](src/laserMapping.cpp#L471)): Effective range for map cube management. Too small → frequent cube shifts and point drops; too large → heavy memory/CPU and noisy far points.
- `LI_extrinsic_T` / `LI_extrinsic_R` (defaults from YAML; [`laserMapping.cpp#L1277`](src/laserMapping.cpp#L1277), [`laserMapping.cpp#L1331`](src/laserMapping.cpp#L1331), [`laserMapping.cpp#L425`](src/laserMapping.cpp#L425)): LiDAR→IMU extrinsics. Errors mis-register points, causing ghosting and drift, and propagate to world/body publishes.
- `point_filter_num` (default `2`; [`laserMapping.cpp#L1235`](src/laserMapping.cpp#L1235), [`laserMapping.cpp#L1351`](src/laserMapping.cpp#L1351), [`preprocess.cpp#L706`](src/preprocess.cpp#L706)): Planar feature stride in preprocess. Higher drops more plane points (faster, less detail); lower keeps more (slower, more accurate).
- `max_iteration` (default `4`; [`laserMapping.cpp#L1233`](src/laserMapping.cpp#L1233), EKF loop [`laserMapping.cpp#L1737`](src/laserMapping.cpp#L1737)): Maximum EKF iterations per frame. More iterations aid convergence but add latency; too few leave higher residuals.
- `filter_size_surf` (default `0.2 m`; [`laserMapping.cpp#L1249`](src/laserMapping.cpp#L1249), [`laserMapping.cpp#L1346`](src/laserMapping.cpp#L1346)): Voxel size for surface downsampling. Larger smooths/accelerates; smaller keeps detail/raises cost.
- `filter_size_map` (default `0.3 m`; [`laserMapping.cpp#L1250`](src/laserMapping.cpp#L1250), [`laserMapping.cpp#L640`](src/laserMapping.cpp#L640)): Map voxel size for insertion and ikd-tree downsample. Larger shrinks map detail/CPU; smaller increases memory and risk of degeneracy in sparse scenes.
- `cube_side_length` (default `2000.0 m`; [`laserMapping.cpp#L1251`](src/laserMapping.cpp#L1251), [`laserMapping.cpp#L471`](src/laserMapping.cpp#L471)): Local map cube size. Small cubes trigger frequent shifts/deletions; very large cubes inflate memory and slow ikd-tree updates.

## publish
- `path_en` (default `true`; [`laserMapping.cpp#L1269`](src/laserMapping.cpp#L1269), [`laserMapping.cpp#L2147`](src/laserMapping.cpp#L2147)): Publish `nav_msgs/Path`. Off saves bandwidth; no trajectory visualization.
- `scan_publish_en` (default `true`; [`laserMapping.cpp#L1270`](src/laserMapping.cpp#L1270), [`laserMapping.cpp#L701`](src/laserMapping.cpp#L701)): Master switch for point cloud outputs. Off disables all cloud publishes (also blocks PCD save gating).
- `dense_publish_en` (default `true`; [`laserMapping.cpp#L1271`](src/laserMapping.cpp#L1271), [`laserMapping.cpp#L701`](src/laserMapping.cpp#L701)): Choose dense vs. downsampled cloud for world-frame publish. Dense is heavier but more detailed.
- `scan_bodyframe_pub_en` (default `false`; [`laserMapping.cpp#L1272`](src/laserMapping.cpp#L1272), [`laserMapping.cpp#L766`](src/laserMapping.cpp#L766)): Publish scan in IMU body frame. Adds topic/transform overhead; consumers must expect body frame.

## pcd_save
- `pcd_save_en` (default `false`; [`laserMapping.cpp#L1274`](src/laserMapping.cpp#L1274), [`laserMapping.cpp#L413`](src/laserMapping.cpp#L413), [`laserMapping.cpp#L738`](src/laserMapping.cpp#L738)): Enables PCD dumps. Increases disk use; on SIGINT writes a final file if interval < 0.
- `pcd_resolution` (default `0.1 m`; [`laserMapping.cpp#L1275`](src/laserMapping.cpp#L1275), [`laserMapping.cpp#L1347`](src/laserMapping.cpp#L1347), [`laserMapping.cpp#L414`](src/laserMapping.cpp#L414)): Voxel size before saving. Smaller = larger, detailed files; larger = smaller, coarser files.
- `interval` (default `-1`; [`laserMapping.cpp#L1276`](src/laserMapping.cpp#L1276), [`laserMapping.cpp#L752`](src/laserMapping.cpp#L752)): Frames per PCD file. `-1` aggregates all scans (risk big file/memory on shutdown); positive rolls files every `interval` frames.
